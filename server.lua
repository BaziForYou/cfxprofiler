local ProfRunning = false
RegisterConsoleListener(function(channel, message)
    if string.find(message, "server thread hitch warning") then
        if not ProfRunning then
          print("Hitch warning detected, starting profiler")
          ExecuteCommand("profiler record 100")
          ProfRunning = true
        end
    end
    if string.find(message, "Stopped the recording") then
        ExecuteCommand("profiler saveJSON resources/sherprofiler/profiler.json")
    end
    if string.find(message, "Save complete") then
        oldnamets = 0
        oldname = None
        json2 = LoadResourceFile(GetCurrentResourceName(), "profiler.json")
        traceEvents = json.decode(json2).traceEvents
        print("The following resources are using more tick time than recommended, please check them out:")
        for k,v in pairs(traceEvents) do
            if string.find(v.name, "tick") then
                if oldname == v.name then
                    ticktime = v.ts - oldnamets
                    if ticktime > 5000 then
                        name = string.gsub(v.name, "tick", "")
                        name = string.gsub(name, "%(", "")
                        name = string.gsub(name, "%)", "")
                        name = string.gsub(name, " ", "")
                        print(name .. ": " .. ticktime / 1000 .. "ms")
                    end
                end
                oldname = v.name
                oldnamets = v.ts
            end
        end
        ProfRunning = false
    end

end)
--────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────#
--................&,..................................................................................................................................#
--.............*&&&&&%................................................................................................................................#
--...........&&&&&&&&&&&...........&&&%......................#&&#.................................%&&#..........................&&&...................#
--........,&&&&&&&&&&&&&&&#........&&&%......................#&&#.................................%&&#..........................&&&...................#
--.............%&&&&&&.............&&&%..(&&&(..&&&&&&&&&&&,.#&&&&&&&&&&..#&&&&&&&&&&#..&&&&&&&&&.%&&#..&&&&&&&&&&...#&&&&&&&&&.&&&...&&&&............#
--.............%&&&&&&.............&&&%&&&&....&&&......&&&,.#&&&....%&&#.#&&&.....(&&&,&&&/......%&&#.&&&......&&&,&&&/........&&&*&&&#..............#
--.............%&&&&&&.............&&&&&&&&....&&&......&&&,.#&&#....%&&#.#&&%......&&&...%&&&&&%.%&&#*&&&......&&&*&&&.........&&&&&&&%..............#
--.............%&&&&&&.............&&&%..%&&&..%&&&#..(&&&&,.#&&#....%&&#.#&&&&...&&&&..#&....&&&.%&&#.%&&&#..(&&&%..&&&&...&&,.&&&...&&&&..(&&/......#
--.............%&&&&&&.............&&&%....%&&&../&&&&#.&&&,.#&&#....%&&#.#&&%,&&&&%....,%&&&&&,..%&&#...,%&&&&&,......%&&&&&,..&&&.....&&&%#&&/......#
--.............%&&&&&&....................................................#&&%........................................................................#
--........................................................................#&&%........................................................................#
--....................................................................................................................................................#
--─────────────────────────────────────────────────────────────────©─2023──⬆─kahpslock────────────────────────────────────────────────────────────────#